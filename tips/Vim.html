<!DOCTYPE html>
<html>
<head>
<title>丘迟的维基世界 - Vim 小贴士</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="Stylesheet" type="text/css" href="../style.css" />
<script>var root_path = '../';</script>
<link href="http://github.com/ktmud/kwiki/commits/master.atom" rel="alternate" title="Kdmud Wiki 的最新更改" type="application/atom+xml" /> 
</head>
<body>
<div id="all">
<div id="header">
	<ul id="top-nav">
		<li>
			<a href="../index.html">首页</a>
		</li>
		<li>
			<a href="../tips/">经验总结</a>
		</li>
		<li>
			<a href="../diary/diary.html">日记</a>
		</li>
	</ul>
</div>
<div id="cse"></div>
<div id="main">
<h1 id="toc_1">Vim</h1>
<div class="toc">
<ul>
<li><a href="#toc_1">Vim</a></li>
<ul>
<li><a href="#toc_1.1">教程</a></li>
<li><a href="#toc_1.2">你知道吗？</a></li>
<ul>
<li><a href="#toc_1.2.1">更易用的JSLint</a></li>
<li><a href="#toc_1.2.2">Vim7.3 的持久撤销</a></li>
</ul>
<li><a href="#toc_1.3">颤抖吧！IDE！</a></li>
</ul>
</ul>
</div>

<h2 id="toc_1.1">教程</h2>
<ol>
<li>
<a href="vim/vimwiki-guide.html">用Vimwiki建一个维基世界</a>
</li>
<li>
<a href="vim/ways-to-sync-vimwiki.html">自动同步你的 vimwiki 到线上网站</a>
</li>
</ol>

<h2 id="toc_1.2">你知道吗？</h2>
<ol>
<li>
在Vimwiki中，可以用 %title 自定义输出的 HTML 的 title ，但是最好写在文件最末尾，不然如果同时使用了 %toc （自动目录）， 就会产生嵌套错误。这个bug将来可能会修正，但保持习惯是没错的。
</li>
<li>
把 _vimrc 和 vimfiles 拷到 msysgit 的安装目录下( <code>C:\Program Files\Git\share\vim</code> )，可以让 Git Bash 里的 vim 也符合你平时的操作习惯。
</li>
</ol>

<h3 id="toc_1.2.1">更易用的JSLint</h3>
<p>
明爷(gracecode.com)曾介绍过<a href="http://www.gracecode.com/archives/2902/">如何在Vim中使用JSLint</a>，他写这篇文章时还没有诞生我今天要介绍的插件：<a href="http://www.vim.org/scripts/script.php?script_id=2729">jslint.vim</a>。
</p>

<p>
事实证明，这个插件是很好用的。不过最初安装时要花点功夫。Linux下按照README的说明来，应该不会遇到什么问题，我这里讲一下在Windows下的注意事项。
</p>

<p>
1. 这个插件只能装在系统用户目录下，即你在Vim里执行 <code>:cd ~</code> 所到的目录。（Win7下是 C:\Users\Username ）
</p>

<p>
要突破上面的限制，修改 <code>ftplugin/javascript/jslint.vim</code> 第16行定义 install_dir 的部分：
$VIMFILES 是我自己在 _vimrc 里定义的变量，在 Windows 下为 <code>D:/dev/Vim/vimfiles</code>
</p>
<pre>
if has("win32")
	let s:install_dir = '"' . expand($VIMFILES."/ftplugin/javascript") . '"'
else
</pre>

<p>
3. 对于带中文的JS文件，容易出现行定位错误的问题。原因和小明那篇文章里说的一样。我们同样在关键地方添加 iconv 转一下字符即可。
</p>

<p>
修改定义 <code>b:jslint_output</code> 的地方：
</p>
<blockquote>
let b:jslint_output = system(s:cmd, iconv(join(s:jslintrc + getline(b:firstline, b:lastline), "\n") . "\n", &amp;enc, "gbk"))
</blockquote>

<p>
这么简单的问题，我折腾了两个小时。之前以为是换行符的问题。唉...
</p>


<h3 id="toc_1.2.2">Vim7.3 的持久撤销</h3>
<p>
Vim 7.3 提供 <strong>持久撤销</strong> (Persistent Undo) 功能，即使文件关闭后，再次打开时仍然可以撤销文件关闭之前的编辑历史。要使用这一功能，在 vimrc 中添加
</p>
<pre>
" 重启后撤销历史可用 persistent undo 
set undofile
set undodir=$VIMFILES/\_undodir
set undolevels=1000 "maximum number of changes that can be undone
</pre>
<p>
<strong>set undofile</strong> - 开启本功能。开启之后会默认在文件当前目录下建立一个 filename.ext.un~ 的文件，自然是会给我们带来麻烦的。所以配置一个 undodir 集中放置所有undofile。
</p>

<p>
<strong>$VIMFILES/\_undodir</strong> - $VIMFILES 是我们之前在 vimrc 中定义的环境变量， windows 下是 $VIM/vimfiles/ 。请注意，为了和其他目录区分，undodir前面有下划线 _undodir 。因为有下划线，前面的反斜杠又不可少了。而且这个目录必须自己手动建立。如果不存在，Vim 是不会帮你自动建立的。
</p>


<h2 id="toc_1.3">颤抖吧！IDE！</h2>
</div>
<div id="footer">
    <p>&copy; 2010 丘迟 &nbsp;&nbsp; <a href="../SiteMap.html" title="站点地图">给我一点导航吧</a></p>
</div>
</div>
<script src="../jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="../vimwiki.js" type="text/javascript"></script>
</body>
</html>
